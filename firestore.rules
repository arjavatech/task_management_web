rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users can only access their own data in cm-users-dev collection
    match /cm-users-dev/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // And all nested collections
      match /companies/{companyId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;

        match /tasks/{taskId} {
          allow read, write: if request.auth != null && request.auth.uid == userId;
        }
      }

      match /taskTemplates/{templateId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      match /notifications/{notificationId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
  }
}